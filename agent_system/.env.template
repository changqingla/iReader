# ============================================================================
# Agent System 统一配置文件
# 所有可配置变量都在此文件中定义，通过环境变量加载
# ============================================================================

# ============================================================================
# LLM 配置
# ============================================================================
TEMPERATURE=0.3                      # LLM 温度（用于推理和压缩摘要）

# ============================================================================
# 上下文和 Token 管理
# ============================================================================
MAX_CONTEXT_TOKENS=128000            # 模型最大上下文窗口
DIRECT_CONTENT_THRESHOLD=0.7         # 直接内容模式阈值：文档<70%可用tokens时直接使用

# ============================================================================
# Agent 基础配置
# ============================================================================
ENABLE_WEB_SEARCH=false              # Web 搜索默认开关
MAX_REPLAN_ATTEMPTS=1                # 最大重新规划次数
EXECUTION_TIMEOUT=300                # 执行超时时间（秒）
MAX_INTENT_RECOGNITION_RETRIES=3     # 意图识别最大重试次数
MAX_CONCURRENT_LLM_CALLS=10          # 最大并发 LLM 调用数（用于多文档总结等场景）

# ============================================================================
# Token 相关常量
# ============================================================================
ESTIMATED_SYSTEM_TOKENS=2000         # 系统提示预估 token 数
RESERVED_ANSWER_TOKENS=8000          # 答案预留 token 数

# ============================================================================
# 上下文压缩配置
# ============================================================================
COMPRESSION_THRESHOLD_RATIO=0.8      # 达到80%上下文时触发压缩
COMPRESSION_PRESERVE_RATIO=0.3       # 保留最近30%的消息不压缩

# ============================================================================
# 时间窗口注入配置
# ============================================================================
INTENT_RECOGNITION_TURNS=3           # 意图识别时注入的历史轮数
PLANNING_TURNS=3                     # 规划时注入的历史轮数
ANSWER_GENERATION_TURNS=3            # 答案生成时注入的历史轮数
EXECUTION_TURNS=0                    # 执行时注入的历史轮数

# ============================================================================
# ReAct Agent 配置
# ============================================================================
REACT_MAX_ITERATIONS=20              # ReAct 最大循环次数，防止无限循环
REACT_MAX_SCRATCHPAD_TOKENS=12800    # Scratchpad 最大 token 数
REACT_TOOL_TIMEOUT=30.0              # 工具执行超时时间（秒）
REACT_TOKEN_WARNING_THRESHOLD=0.85   # Token 使用率警告阈值
REACT_ENABLE_HOOKS=true              # 是否启用 Hook 机制
REACT_ENABLE_LOOP_DETECTION=true     # 是否启用循环检测
REACT_MAX_SAME_TOOL_CALLS=2          # 同一工具相同输入的最大调用次数
REACT_ENABLE_COMPLETION_DETECTION=true  # 是否启用智能完成检测
REACT_MIN_SUCCESSFUL_CALLS=2         # 至少需要的成功工具调用数
REACT_MAX_CONSECUTIVE_ERRORS=5       # 最大连续错误数
REACT_SHOW_ITERATION_PROGRESS=true   # 是否显示迭代进度
REACT_SHOW_SCRATCHPAD_STATS=true     # 是否显示 scratchpad 统计

# ============================================================================
# 文档处理配置
# ============================================================================
LARGE_DOC_SUMMARY_TOP_N=35           # 大文档总结时的召回数量

# ============================================================================
# 缓存配置
# ============================================================================
RECALL_TOOL_CACHE_SIZE=100           # RecallTool 缓存大小
ENABLE_CACHE=true                    # 是否启用缓存
CACHE_READ_TIMEOUT=2                 # 缓存读取超时（秒）
BATCH_SIZE=50                        # 批处理大小

# ============================================================================
# Web 搜索配置
# ============================================================================
TAVILY_MAX_RESULTS=5                 # Tavily 搜索最大结果数
SEARCH_MAX_RESULTS=5                 # 搜索结果数量

# ============================================================================
# Redis 配置
# ============================================================================
REDIS_HOST=host.docker.internal      # Redis 主机地址（Docker 容器访问宿主机）
REDIS_PORT=6378                      # Redis 端口
REDIS_DB=3                           # Redis 数据库编号
REDIS_USERNAME=reader               # Redis 用户名（可选）
REDIS_PASSWORD=agent123              # Redis 密码（可选）
REDIS_SOCKET_TIMEOUT=5               # Redis Socket 超时（秒）
REDIS_SOCKET_CONNECT_TIMEOUT=5       # Redis 连接超时（秒）
REDIS_SCAN_COUNT=100                 # Redis SCAN 每次返回数量
SESSION_CACHE_TTL=3600               # 会话缓存 TTL（秒）
MESSAGE_CACHE_TTL=1800               # 消息缓存 TTL（秒）

# ============================================================================
# PostgreSQL 配置
# ============================================================================
POSTGRES_HOST=reader_postgres   # PostgreSQL 主机地址（Docker 容器访问宿主机）
POSTGRES_PORT=5432                   # PostgreSQL 端口
POSTGRES_DB=reader_qaq               # PostgreSQL 数据库名
POSTGRES_USER=reader                 # PostgreSQL 用户名
POSTGRES_PASSWORD=reader_dev_password  # PostgreSQL 密码
POSTGRES_POOL_SIZE=10                # 连接池大小
POSTGRES_MAX_OVERFLOW=20             # 最大溢出连接数

# ============================================================================
# 取消管理器配置
# ============================================================================
CANCELLATION_EXPIRY_SECONDS=300      # 取消记录过期时间（秒）

# ============================================================================
# Logging & API
# ============================================================================
LOG_LEVEL=INFO                       # 日志级别
LOG_FILE=./logs/agent.log            # 日志文件路径
API_HOST=0.0.0.0                     # API 监听地址
API_PORT=8009                        # API 监听端口
